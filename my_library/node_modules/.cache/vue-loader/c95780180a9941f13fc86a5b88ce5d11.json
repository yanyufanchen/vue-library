{"remainingRequest":"C:\\Users\\wangpeng\\Desktop\\mt\\vue-ht\\library\\my_library\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\wangpeng\\Desktop\\mt\\vue-ht\\library\\my_library\\src\\components\\Book\\OverdueInfo.vue?vue&type=style&index=0&id=5ca7e150&lang=less&scoped=true&","dependencies":[{"path":"C:\\Users\\wangpeng\\Desktop\\mt\\vue-ht\\library\\my_library\\src\\components\\Book\\OverdueInfo.vue","mtime":1578115298646},{"path":"C:\\Users\\wangpeng\\Desktop\\mt\\vue-ht\\library\\my_library\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"C:\\Users\\wangpeng\\Desktop\\mt\\vue-ht\\library\\my_library\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\wangpeng\\Desktop\\mt\\vue-ht\\library\\my_library\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\wangpeng\\Desktop\\mt\\vue-ht\\library\\my_library\\node_modules\\less-loader\\dist\\cjs.js","mtime":1576755764101},{"path":"C:\\Users\\wangpeng\\Desktop\\mt\\vue-ht\\library\\my_library\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\wangpeng\\Desktop\\mt\\vue-ht\\library\\my_library\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n.checking{\r\n  margin: 20px 0;\r\n  .codeName{\r\n    width: 12.5rem;margin-right: 10px;\r\n  }\r\n  .add{float: right;}\r\n}\r\n.page_size{display: inline-block;float: right;}\r\n",{"version":3,"sources":["OverdueInfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"OverdueInfo.vue","sourceRoot":"src/components/Book","sourcesContent":["<template>\r\n  <div>\r\n    <!-- 导航 -->\r\n    <Breadcrumb :value=\"common\"></Breadcrumb>\r\n    <el-card class=\"box-card\">\r\n      <!-- 借阅逾期管理 -->\r\n      <el-row class=\"checking\">\r\n        <el-col :span=\"18\">\r\n          <div class=\"grid-content bg-purple\">\r\n            <span class=\"com_title\">Borrower：</span>\r\n            <el-input\r\n              class=\"codeName\"\r\n              ref=\"com_name\"\r\n              size=\"small\"\r\n              placeholder=\"Please enter the borrower's name\"\r\n              v-model=\"input1\"\r\n              clearable\r\n              @clear=\"clear\"\r\n            ></el-input>\r\n            <span class=\"com_title\">Titles of books：</span>\r\n            <el-input\r\n              class=\"codeName\"\r\n              size=\"small\"\r\n              ref=\"com_name\"\r\n              placeholder=\"Please enter title\"\r\n              v-model=\"value1\"\r\n              clearable\r\n              @clear=\"clear\"\r\n            ></el-input>\r\n            <el-button type=\"info\" size=\"small\" @click=\"searchClick\">Query</el-button>\r\n          </div>\r\n        </el-col>\r\n      </el-row>\r\n      <el-table :data=\"tableData\" style=\"width: 100%\">\r\n        <el-table-column prop=\"name\" label=\"Borrower\"></el-table-column>\r\n        <el-table-column prop=\"title\" label=\"Title\"></el-table-column>\r\n        <el-table-column prop=\"dueDate\" label=\"Return date\"></el-table-column>\r\n        <el-table-column prop=\"overdueTime\" label=\"overdue time\"></el-table-column>\r\n        <el-table-column prop=\"delay_penalty\" label=\"delay penalty\"></el-table-column>\r\n      </el-table>\r\n      <el-pagination\r\n        v-if=\"show\"\r\n        class=\"page_size\"\r\n        background=\"\"\r\n        layout=\"prev, pager, next\"\r\n        :page-size=\"pageSize\"\r\n        :current-page=\"currentPage\"\r\n        @current-change=\"handleCurrentChange\"\r\n        :total=\"allCount\"\r\n      ></el-pagination>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n<script>\r\n  import {getAuthorAll, getAllBook,loanBook_api,getLoan_api,addLoan_api,updataLoan_api,deleteLoan_api,getPenalty_api} from '@/api'\r\n  import moment from 'moment' // 时间过滤插件\r\nexport default {\r\n  data() {\r\n    return {\r\n      pickerOptions0: {\r\n        disabledDate(time) {\r\n          return time.getTime() < Date.now()//如果没有后面的-8.64e7就是不可以选择今天的\r\n       }\r\n      },\r\n      common: ['overdueInfo'], // 公共组件传值\r\n      input1: '',\r\n      value1: '',\r\n      allCount:null,\r\n      currentPage:1,\r\n      pageSize:10,\r\n      tableData: [],\r\n      comName:[],\r\n      comTitle:[],\r\n      dialogFormVisible: false,\r\n      editFormVisible: false,\r\n      show:true,\r\n      addForm: {\r\n        name: '',\r\n        title: '',\r\n        dueDate: '',\r\n        BookId:'',\r\n        UserId:'',\r\n        id:'',\r\n      },\r\n      editRegion: {\r\n        name: '',\r\n        title: '',\r\n        dueDate: '',\r\n        BookId:'',\r\n        UserId:'',\r\n        id:'',\r\n      },\r\n      formLabelWidth: '140px',\r\n      rules: {\r\n        name: [{ required: true, message: 'Please input name', trigger: 'blur' }],\r\n        title: [{ required: true, message: 'Please input title', trigger: 'blur' }],\r\n        dueDate: [{ required: true, message: 'Please input date', trigger: 'blur' }]\r\n\t\t  }\r\n    }\r\n  },\r\n  created() {\r\n    this.getLoanBookAll()\r\n    // this.getAuthorAll()\r\n    // this.getAllBook()\r\n  },\r\n  methods: {\r\n    // 清除clearInput\r\n    clear(){\r\n      this.show = true;\r\n        this.getLoanBookAll()\r\n    },\r\n    //获取借阅及逾期信息\r\n    async getLoanBookAll() {\r\n      const { data: penalty_res } = await getPenalty_api({PenaltyId: 1})\r\n      let penaltyNum=penalty_res.data.delay_penalty\r\n      if (penalty_res.status!== 200){\r\n        penaltyNum=0\r\n      }\r\n      let params = {\r\n        \"pagesize\":this.pageSize,\r\n        \"pageNO\":this.currentPage\r\n      }\r\n      const { data: res } = await loanBook_api(params)\r\n      if (res.status !== 200) return this.$message.error(res.msg)\r\n      for (var i in res.data) {\r\n        res.data[i].overdueTime=Math.ceil((res.data[i].dueDate-(+new Date()))/1000/60/60/24)\r\n        \r\n        if(res.data[i].overdueTime<=0){\r\n          res.data[i].delay_penalty='￥ '+res.data[i].overdueTime*penaltyNum\r\n          res.data[i].overdueTime='overdue '+Math.abs(res.data[i].overdueTime)+' day'\r\n        }else {\r\n          res.data[i].delay_penalty='￥ '+0\r\n          res.data[i].overdueTime='only '+res.data[i].overdueTime+' day'\r\n        }\r\n        res.data[i].dueDate = moment(res.data[i].dueDate).format('YYYY-MM-DD')\r\n      }\r\n      this.tableData = res.data\r\n      this.allCount = res.total\r\n    },\r\n    //分页\r\n    async handleCurrentChange(currentPage){\r\n      this.currentPage = currentPage;\r\n      let params = {\r\n        \"pagesize\":this.pageSize,\r\n        \"pageNO\":this.currentPage\r\n      }\r\n      const { data: res } = await loanBook_api(params)\r\n      if (res.status !== 200) return this.$message.error(res.msg)\r\n      for (var i in res.data) {\r\n        res.data[i].dueDate = moment(res.data[i].dueDate).format('YYYY-MM-DD')\r\n      }\r\n      this.tableData = res.data\r\n      this.allCount = res.total\r\n    },\r\n\t  //query\r\n\t  searchClick(){ // 查询功能\r\n\t  \tconst nameCom = this.input1; //读者名\r\n\t  \tconst bookCom = this.value1; // 书名\r\n      if(nameCom == '' && bookCom == ''){\r\n        this.show = true;\r\n        this.getLoanBookAll()\r\n      }else{\r\n\r\n        var params = {\r\n          \"bookTitle\": bookCom,\r\n          \"userName\": nameCom\r\n        }\r\n        getLoan_api(params).then(res => {\r\n          if (res.data.status !== 200) {\r\n            return this.$message.error(res.data.data.msg)\r\n          } else {\r\n            for (var i in res.data.data) {\r\n              res.data.data[i].dueDate = moment(res.data.data[i].dueDate).format('YYYY-MM-DD')\r\n            }\r\n            this.tableData = res.data.data\r\n            this.allCount = res.data.data.length\r\n          }\r\n        })\r\n      }\r\n\t  },\r\n\t  //add\r\n\t  submitForm(formName){\r\n\t      var that = this\r\n\t  \tthis.$refs[formName].validate((valid) =>{\r\n\t  \t\tif(valid){\r\n          var timestamp2 = Date.parse(new Date(that.addForm.dueDate))\r\n\t  \t\t\tvar params ={\r\n            \"bookTitle\":that.addForm.title,\r\n            \"userName\":that.addForm.name,\r\n            \"dueDate\":timestamp2\r\n          }\r\n\t  \t\t\tthis.$confirm('Whether to commit',{\r\n\t  \t\t\t\tconfirmButtonText:'confirm',\r\n\t  \t\t\t\tcancelButtonText:'cancel',\r\n\t  \t\t\t\ttype:'warning',\r\n\t  \t\t\t\tcenter:true\r\n\t  \t\t\t})\r\n\t  \t\t\t.then(function(){\r\n\t  \t\t\t\t//ajax\r\n\t  \t\t\t\taddLoan_api(params).then(res =>{\r\n\t  \t\t\t\t\tif(res.status == 200){ //此处的表单验证\r\n\t  \t\t\t\t\t\tthat.dialogFormVisible = false\r\n\t  \t\t\t\t\t\tthat.getLoanBookAll() //重新渲染数据\r\n\t  \t\t\t\t\t}else{\r\n\t  \t\t\t\t\tthat.$confirm(res.result.msg, 'hint', {\r\n\t                    type: 'warning'\r\n\t               \t})\r\n              }\r\n\t  \t\t\t\t}).catch(err =>{console.log(err)})\r\n\t  \t\t\t})\r\n\t  \t\t\t.catch(function(err){\r\n\t  \t\t\t\tconsole.log('Cancel')\r\n\t  \t\t\t})\r\n\t  \t\t} else {\r\n\t  \t\t\treturn false\r\n\t  \t\t}\r\n\t  \t})\r\n\t  },\r\n\t  handleEdit(index, row) {\r\n\t      this.editFormVisible = true;\r\n\t      this.editRegion = Object.assign({\r\n          dueDate: row.dueDate,\r\n          LoanId:row.id\r\n          }); //这句是关键！！！\r\n\t  },\r\n\t  editSubmitRegion (formName) {\r\n\t  \tvar that = this\r\n\t  \tthis.$refs[formName].validate((valid) =>{\r\n\t  \t\tif(valid){\r\n          var timestamp2 = Date.parse(new Date(that.editRegion.dueDate))\r\n          var params = {\r\n            duetime: timestamp2,\r\n            LoanId:that.editRegion.LoanId\r\n          }\r\n\t  \t\t\tthis.$confirm('Whether to commit',{\r\n\t  \t\t\t\tconfirmButtonText:'confirm',\r\n\t  \t\t\t\tcancelButtonText:'cancel',\r\n\t  \t\t\t\ttype:'warning',\r\n\t  \t\t\t\tcenter:true\r\n\t  \t\t\t})\r\n\t  \t\t\t.then(function(){\r\n\t  \t\t\t\t//ajax\r\n\t  \t\t\t\tupdataLoan_api(params).then(res =>{\r\n\t  \t\t\t\t\tif(res.data.status == 200){\r\n\t  \t\t\t\t\t\tthat.editFormVisible = false\r\n\t  \t\t\t\t\t\tthat.getLoanBookAll() //重新渲染数据\r\n\t  \t\t\t\t\t}else{\r\n\t  \t\t\t\t\t\tthat.$confirm(res.data.msg, 'hint', {\r\n\t                    type: 'warning'\r\n\t               \t})\r\n\t  \t\t\t\t\t}\r\n\t  \t\t\t\t}).catch(err =>{console.log(err)})\r\n\t  \t\t\t})\r\n\t  \t\t\t.catch(function(err){\r\n\t  \t\t\t\tconsole.log('Cancel')\r\n\t  \t\t\t})\r\n\t  \t\t} else {\r\n\t  \t\t\treturn false\r\n\t  \t\t}\r\n\t  \t})\r\n\t  },\r\n\t  //delete\r\n\t  handleDelete (index,row) {\r\n\t      var _self = this;\r\n\t      this.$confirm('Are you sure to delete?', 'hint', {\r\n        confirmButtonText:'delete',\r\n        cancelButtonText:'waiting',\r\n        type:'warning',\r\n        center:true\r\n          }).then(function(){\r\n          let params = {\r\n            loanId:row.id\r\n          }\r\n          deleteLoan_api({data:params}).then(res => {\r\n            if(res.status == 200){\r\n              _self.$message({\r\n                message: 'successfully delete',\r\n                type: 'success'\r\n              });\r\n          _self.getLoanBookAll() //重新渲染数据\r\n            }\r\n          }).catch(err =>{console.log(err)})\r\n          }).catch(function(e){\r\n            if(e != \"cancel\")\r\n              console.log(\"error：\" + e);\r\n          });\r\n      },\r\n  },\r\n  mounted() {}\r\n}\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.checking{\r\n  margin: 20px 0;\r\n  .codeName{\r\n    width: 12.5rem;margin-right: 10px;\r\n  }\r\n  .add{float: right;}\r\n}\r\n.page_size{display: inline-block;float: right;}\r\n</style>\r\n"]}]}